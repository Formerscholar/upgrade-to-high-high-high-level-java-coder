## Message存储在Broker Server如何被清理



一、消息是存在commitlog文件中的，所以消息不会被逐条清理，而是随着commitlog文件而被清理掉，注意commitlog文件清理不会理会消息有没有被消费过，是直接清理掉的。



二、commitlog文件的清理规则：

1. 文件过期（超过72小时），且到达了时间清理的时间点（默认为凌晨4点），自动清理过期的commitlog
2. 文件过期（超过72小时），且磁盘空间占用率已达到过期清理警戒线（默认75%），无论是否到达清理时间点，都会自动清理文件
3. 磁盘占用率达到清理警戒线（默认85%）后，开始按照设定好的规则清理文件，无论是否过期。默认会从最老的文件开始清理
4. 磁盘占用率达到系统危险警戒线（默认90%），Broker将拒绝消息写入。