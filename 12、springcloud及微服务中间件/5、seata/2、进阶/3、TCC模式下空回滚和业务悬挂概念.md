## 空回滚和业务悬挂



AT模式不用考虑这俩问题



在执行扣款事务的情况下，账户余额为100，try下会冻结资金30元，如果事务执行成功则扣款30将余额变为70，如果事务执行失败则需要将冻结的资金改回去！

#### 1、什么叫空回滚

服务在未收到Try请求的情况下收到Cancel请求（两个请求可能同时发出，但是由于网络原因Cancel的请求现到了就先被处理了）这就叫空回滚。

#### 2、什么叫业务悬挂

调用服务的一阶段 Try 操作时（冻结资金），可能会出现因网络拥堵而导致的超时，此时事务管理器会触发二阶段回滚（<font color="red">空回滚</font>），调用Cancel 操作，Cancel调用未超时；在此之后，拥堵在网络上的一阶段 Try 数据包被服务收到，出现了二阶段 Cancel 请求比一阶段 Try 请求先执行的情况，此服务在执行晚到的 Try 之后，将永远不会再收到二阶段的 Confirm 或者 Cancel ，造成业务服务悬挂，冻结的资金就一直会被冻结了！

